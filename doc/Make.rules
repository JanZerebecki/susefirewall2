# Makefile rules for docbook docu
# need to set the following variables:
# allhtml: list of html articles to create
# alltxt: list of txt articles to create

xsl_html := custom-html.xsl

DESTDIR := ./

admongfx := /usr/share/doc/manual/suselinux-adminguide_de/html/admon/
naviggfx := /usr/share/doc/manual/suselinux-adminguide_de/html/navig/
stylesheet := /usr/share/xml/docbook/custom/susedtd/*/stylesheet/susebooks.css
stylesheet_out := susebooks.css

all: all-single all-txt links

all-single: $(DESTDIR)$(stylesheet_out) $(allhtml)

all-txt: $(alltxt)

$(DESTDIR)$(stylesheet_out): $(stylesheet)
	@cat < $< > $@
	@if ! grep -q 'pre\\.programlisting' $@; then \
		echo "add programlisting to stylesheet"; \
		echo 'pre.programlisting { background-color: #E0E0E0; }' >> $@; \
	fi
#sed "s/sect1/section/g" < $< > $@


$(DESTDIR)%.html: %.xml $(DESTDIR)$(stylesheet_out)
	xmllint --nonet --valid --noout $<
	xsltproc --nonet \
	       	--output $@ $(xsl_html) $<

%.txt: %.html
	w3m -dump $< > $@

clean:
	rm -rf $(allhtml) $(DESTDIR)html $(DESTDIR)$(stylesheet_out) $(alltxt)

.PHONY: clean html

# vim: syntax=make
